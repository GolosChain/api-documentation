ВНИМАНИЕ - Документация в процессе доработки!
Актуальность апи от 06.03.

# Документация для работы с API сервисов CyberWay BackEnd

## Пояснения

#### Общая информация

Инфраструктура CyberWay состоит из 3х основных частей:

- CyberWay BlockChain
- CyberWay BackEnd
- CyberWay Client

Любой сайт, мобильное приложение или что-либо иное, общающееся с BlockChain и/или BackEnd относится к категории Client.

К BlockChain относятся блокчейн-ноды CyberWay и вспомогательные сервисы, подключаемые напрямую к блокчейн-ноде и
существующие вместе с ней, например EventEngine, который может отсутсвовать или присутствовать у каждой конкретной ноды,
но является лишь вспомогательной частью или утилитой и относится к категории BlockChain.

К категории BackEnd относятся разнообразные вспомогательные микросервисы, имеющие одну единую точку входа для каждого
набора запущенных микросервисов. Эта документация содержит описание общения именно с этими микросервисами через
единую точку входа и предполагает что за ней находятся и развернуты все необходимые микросервисы.

#### Формат запросов и ответов

Для того чтобы подключиться к системе необходимо создать WebSocket подключение к входной точке по установленному
эндпоинту подключения. Например - `wss://gate.site.com`.

Общение происходит по протоколу [JSON-RPC 2.0](https://www.jsonrpc.org/specification) с некоторыми более строгими
правилами:

- Параметры запроса должны только быть именованными, в виде JSON-объекта, безымянные не поддерживаются.
- Результат запроса в поле `result` всегда содержит JSON объект с результатом выполнения.
- В случае если результат запроса не предполагает конкретного ответа - в поле `result` всегда содержит JSON объект
  с данными `{"status": "OK"}` (без вариаций).
- В случае ошибки в поле `error` всегда содержится ответ формата `{"code": 123, "message": "Description text"}`,
  где `code` это цифровой код ошибки, описывающий тип проишествия, а `description` - текстовую ремарку для понимания
  ошибки человеком.
- RPC-нотификации работают как указано в стандарте, запросы без поля `id` не получают ответа, но сервер может
  их обработать по своему усмотрению.

Дополнительно стоит учитывать что сервер сам может передавать данные на клиент без получения запроса - например
так работает рассылка о событиях для пользователя, данные поступают через WebSocket со стороны сервера и
являются RPC-нотификациями, что не требует от клиента возвращать серверу какой-либо ответ.

#### Формат апи-документации

Будет описан позднее...

## API

### Регистрация

Регистрация предоставляет возможность зарегистрировать пользователя используюя различные стратегии
регистрации. Стратегию регистрации выбирает сервер. В любой момент времени можно получить текущий шаг
регистрации пользователя, что позволяет прерывать процесс регистрации на необходимое время. Однако,
стоит учесть что существуют лимиты времени на ожидание продолжения регистрации, после их истечения
пользователь удаляется из базы предварительной регистрации, что высвобождает занятое имя и регистрацию
под указанным именем можно инициировать снова.

---

#### `registration.getState`

**Запрос ===>**

|       Процедура       | Авторизация  | Описание                                  |
| :-------------------: | :----------: | ----------------------------------------- |
| registration.getState | Не требуется | Получить шаг регистрации для пользователя |

| Параметр |  Тип   | Обяз. | Описание         |
| :------: | :----: | :---: | ---------------- |
|   user   | string |  Да   | Имя пользователя |

Пример:

Получаем состояние регистрации для пользователя

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.getState",
  "params": {
    "user": "destroyer2k"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `registration.firstStep`

**Запрос ===>**

|       Процедура        | Авторизация  | Описание                        |
| :--------------------: | :----------: | ------------------------------- |
| registration.firstStep | Не требуется | Сделать первый шаг регистрациия |

| Параметр |  Тип   |      Обяз.       | Описание                  |
| :------: | :----: | :--------------: | ------------------------- |
|   user   | string |        Да        | Имя пользователя          |
|  phone   | string |        Да        | Телефон пользователя      |
|   mail   | string |        Да        | Почта пользователя        |
| captcha  | string | Публичный сервер | Верификационный код капчи |

Пример:

Запускаем первый шаг регистрации

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.firstStep",
  "params": {
    "user": "destroyer2k",
    "phone": "5555555",
    "mail": "user@site.com",
    "captcha": "dEdOdpabEsiboD4z"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `registration.verify`

**Запрос ===>**

|      Процедура      | Авторизация  | Применимость        | Описание                        |
| :-----------------: | :----------: | ------------------- | ------------------------------- |
| registration.verify | Не требуется | Стратегия smsToUser | Сделать верификацию регистрации |

| Параметр |       Тип       | Обяз. | Описание         |
| :------: | :-------------: | :---: | ---------------- |
|   user   |     string      |  Да   | Имя пользователя |
|   code   | string / number |  Да   | Код из смс       |

Пример:

Верифицируем код пользователя из CMC

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.verify",
  "params": {
    "user": "destroyer2k",
    "code": 4682
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `registration.toBlockChain`

**Запрос ===>**

|         Процедура         | Авторизация  | Описание                                  |
| :-----------------------: | :----------: | ----------------------------------------- |
| registration.toBlockChain | Не требуется | Зарегистрировать пользователя в блокчейне |

| Параметр |  Тип   | Обяз. | Описание                 |
| :------: | :----: | :---: | ------------------------ |
|   user   | string |  Да   | Имя пользователя         |
|  owner   | string |  Да   | Ключ владельца           |
|  active  | string |  Да   | Активный ключ            |
| posting  | string |  Да   | Постинг ключ             |
|   memo   | string |  Да   | Мемо ключ (ключ заметок) |

Пример:

Регистрируем пользователя непосредственно в блокчейне

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.toBlockChain",
  "params": {
    "user": "destroyer2k",
    "owner": "SkdoEpqdDldinm",
    "active": "dfoekDfoakeiE",
    "posting": "piqkEldioldoke",
    "memo": "oPqiamjklEoEEa"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `registration.changePhone`

**Запрос ===>**

|        Процедура         | Авторизация  | Применимость                     | Описание               |
| :----------------------: | :----------: | -------------------------------- | ---------------------- |
| registration.changePhone | Не требуется | Стратегия smsFromUser, smsToUser | Сменить номер телефона |

| Параметр |  Тип   |      Обяз.       | Описание                  |
| :------: | :----: | :--------------: | ------------------------- |
|   user   | string |        Да        | Имя пользователя          |
|  phone   | string |        Да        | Телефон пользователя      |
| captcha  | string | Публичный сервер | Верификационный код капчи |

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

Пример:

Меняем телефон пользователя на новый

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.changePhone",
  "params": {
    "user": "destroyer2k",
    "phone": "5555566",
    "captcha": "dlkEdlsIpqpkaZdkl"
  }
}
```

---

#### `registration.resendSmsCode`

**Запрос ===>**

|         Процедура          | Авторизация  | Применимость        | Описание                                  |
| :------------------------: | :----------: | ------------------- | ----------------------------------------- |
| registration.resendSmsCode | Не требуется | Стратегия smsToUser | Переотправить код на телефон пользователя |

| Параметр |  Тип   |     Обяз.      | Описание             |
| :------: | :----: | :------------: | -------------------- |
|   user   | string | Если нет phone | Имя пользователя     |
|  phone   | string | Если нет user  | Телефон пользователя |

Пример:

Отправка смс на телефон пользователя повторно

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.resendSmsCode",
  "params": {
    "user": "destroyer2k",
    "phone": "55555555"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `registration.subscribeOnSmsGet`

**Запрос ===>**

|           Процедура            | Авторизация  | Применимость          | Описание                                     |
| :----------------------------: | :----------: | --------------------- | -------------------------------------------- |
| registration.subscribeOnSmsGet | Не требуется | Стратегия smsFromUser | Подписаться на получение смс от пользователя |

| Параметр |  Тип   |     Обяз.      | Описание             |
| :------: | :----: | :------------: | -------------------- |
|   user   | string | Если нет phone | Имя пользователя     |
|  phone   | string | Если нет user  | Телефон пользователя |

Пример:

Подписка на факт получение смс от пользователя

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "registration.subscribeOnSmsGet",
  "params": {
    "user": "destroyer2k",
    "phone": "55555555"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

### Настройки пользователя

Настройки пользователя представляют частично структурированное хранилище не критичных настроек
пользователя, таких как язык интерфейса, предпочитаемая отображаемая валюта, оповещение о каких-либо
комментариях и подобное.

При этом подразумевается 3 типа настроек:

- notify - хранилище настроек web-нотификаций
- push - хранилище настроек mobile-нотификаций
- basic - хранилище иных неструктурированных настроек

---

#### `options.get`

**Запрос ===>**

|  Процедура  | Авторизация | Описание                        |
| :---------: | :---------: | ------------------------------- |
| options.get |  Требуется  | Получить настройки пользователя |

| Параметр |  Тип   | Обяз. | Описание                                                                                                                                                                                                                           |
| :------: | :----: | :---: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| profile  | string |  Да   | Произвольная строка - например идентификатор устройства, класса устройств или иной произвольный идентификатор клиента, например для Android-телефонов это может быть идентификатор устройства, а для браузеров просто строка `web` |

Пример:

Получаем настройки текущего авторизованного пользователя по профилю `browser`

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "options.get",
  "params": {
    "profile": "browser"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `options.set`

**Запрос ===>**

|  Процедура  | Авторизация | Описание                         |
| :---------: | :---------: | -------------------------------- |
| options.set |  Требуется  | Сохранить настройки пользователя |

| Параметр | **\_** |      **\_**       | Варианты | По умолч. |   Тип   | Обяз. | Описание                                                                                                                                                                                                                                                                                                |
| :------: | :----: | :---------------: | :------: | :-------: | :-----: | :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| profile  |        |                   |          |           | string  |  Да   | Произвольная строка - например идентификатор устройства, класса устройств или иной произвольный идентификатор клиента, например для Android-телефонов это может быть идентификатор устройства, а для браузеров просто строка `web`                                                                      |
|  basic   |        |                   |          |           | object  |  Нет  | Произвольный JSON-объект данных, который будет присоединен к существующим данным слиянием по ключам - измения затронут только те ключи существующих данных что находятся в JSON-объекте, произойдет их полная замена на новые данные, остальные данные по другим ключам затронуты не будут              |
|  notify  |        |                   |          |           | object  |  Нет  | JSON-объект настроек web-нотификаций                                                                                                                                                                                                                                                                    |
|          |  show  |                   |          |           | object  |  Нет  | JSON-объект настроек отображения нотификаций, который будет присоединен к существующим данным слиянием по ключам - измения затронут только те ключи существующих данных что находятся в JSON-объекте, произойдет их полная замена на новые данные, остальные данные по другим ключам затронуты не будут |
|          |        |      upvote       |          |           | boolean |  Нет  | Оповещения о лайке (голосе за)                                                                                                                                                                                                                                                                          |
|          |        |     downvote      |          |           | boolean |  Нет  | Оповещения о дизлайке (голосе против)                                                                                                                                                                                                                                                                   |
|          |        |     transfer      |          |           | boolean |  Нет  | Оповещения о переводе средств                                                                                                                                                                                                                                                                           |
|          |        |       reply       |          |           | boolean |  Нет  | Оповещение об ответе на пост/комментарий                                                                                                                                                                                                                                                                |
|          |        |     subscribe     |          |           | boolean |  Нет  | Оповещение о подписке                                                                                                                                                                                                                                                                                   |
|          |        |    unsubscribe    |          |           | boolean |  Нет  | Оповещение об отписке                                                                                                                                                                                                                                                                                   |
|          |        |      mention      |          |           | boolean |  Нет  | Оповещение об упоминании в посте/комментарии                                                                                                                                                                                                                                                            |
|          |        |      repost       |          |           | boolean |  Нет  | Оповещение о репосте                                                                                                                                                                                                                                                                                    |
|          |        |      reward       |          |           | boolean |  Нет  | Оповещение о награде за пост/комментарий                                                                                                                                                                                                                                                                |
|          |        |   curatorReward   |          |           | boolean |  Нет  | Оповещение о награде за устаноку лайка за пост/комментарий                                                                                                                                                                                                                                              |
|          |        |      message      |          |           | boolean |  Нет  | Оповещение о личном сообщении через блокчейн                                                                                                                                                                                                                                                            |
|          |        |    witnessVote    |          |           | boolean |  Нет  | Оповещение об установке голосова другим пользователем за делегатство текущего                                                                                                                                                                                                                           |
|          |        | witnessCancelVote |          |           | boolean |  Нет  | Оповещение о снятии голоса другим пользователем за делегатство текущего                                                                                                                                                                                                                                 |
|   push   |        |                   |          |           | object  |  Нет  | JSON-объект настроек mobile-нотификаций                                                                                                                                                                                                                                                                 |
|          |  show  |                   |          |           | object  |  Нет  | JSON-объект настроек отображения нотификаций, который будет присоединен к существующим данным слиянием по ключам - измения затронут только те ключи существующих данных что находятся в JSON-объекте, произойдет их полная замена на новые данные, остальные данные по другим ключам затронуты не будут |
|          |        |      upvote       |          |           | boolean |  Нет  | Оповещения о лайке (голосе за)                                                                                                                                                                                                                                                                          |
|          |        |     downvote      |          |           | boolean |  Нет  | Оповещения о дизлайке (голосе против)                                                                                                                                                                                                                                                                   |
|          |        |     transfer      |          |           | boolean |  Нет  | Оповещения о переводе средств                                                                                                                                                                                                                                                                           |
|          |        |       reply       |          |           | boolean |  Нет  | Оповещение об ответе на пост/комментарий                                                                                                                                                                                                                                                                |
|          |        |     subscribe     |          |           | boolean |  Нет  | Оповещение о подписке                                                                                                                                                                                                                                                                                   |
|          |        |    unsubscribe    |          |           | boolean |  Нет  | Оповещение об отписке                                                                                                                                                                                                                                                                                   |
|          |        |      mention      |          |           | boolean |  Нет  | Оповещение об упоминании в посте/комментарии                                                                                                                                                                                                                                                            |
|          |        |      repost       |          |           | boolean |  Нет  | Оповещение о репосте                                                                                                                                                                                                                                                                                    |
|          |        |      reward       |          |           | boolean |  Нет  | Оповещение о награде за пост/комментарий                                                                                                                                                                                                                                                                |
|          |        |   curatorReward   |          |           | boolean |  Нет  | Оповещение о награде за устаноку лайка за пост/комментарий                                                                                                                                                                                                                                              |
|          |        |      message      |          |           | boolean |  Нет  | Оповещение о личном сообщении через блокчейн                                                                                                                                                                                                                                                            |
|          |        |    witnessVote    |          |           | boolean |  Нет  | Оповещение об установке голосова другим пользователем за делегатство текущего                                                                                                                                                                                                                           |
|          |        | witnessCancelVote |          |           | boolean |  Нет  | Оповещение о снятии голоса другим пользователем за делегатство текущего                                                                                                                                                                                                                                 |
|          |  lang  |                   |          |    ru     | string  |  Нет  | Язык рассылаемых уведомлений                                                                                                                                                                                                                                                                            |
|          |        |                   |    ru    |           | string  |  Нет  | Русский язык                                                                                                                                                                                                                                                                                            |
|          |        |                   |    en    |           | string  |  Нет  | Английский язык                                                                                                                                                                                                                                                                                         |

Пример:

Меняем настройки рассылки для web-нотификаций - включаем отображение лайков и отключаем дизлайков

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "options.set",
  "params": {
    "profile": "aFiclsSPkdshg",
    "notify": {
      "show": {
        "upvote": true,
        "downvote": false
      }
    }
  }
}
```

Включаем отображение репостов на мобильных устройствах, при этом отключаем их для web-нотификаций

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "options.set",
  "params": {
    "profile": "doskEsfdlnkl",
    "push": {
      "show": {
        "repost": true
      }
    },
    "notify": {
      "show": {
        "repost": false
      }
    }
  }
}
```

Установка предпочитаемой валюты отображения на `USD`, а языка мобильных оповещений на английский

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "options.set",
  "params": {
    "profile": "odslkhYslkd",
    "basic": {
      "currency": "USD"
    },
    "push": {
      "lang": "en"
    }
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

### Онлайн-нотификации с учетом настроек (WebSocket)

Имеется возможность работать с нотификациями о каких-либо событиях, рассылаемых с сервера на клиент
через WebSocket, достаточно лишь вызвать метод подписывающий текущий коннект на их получение.
Имеется возможность включать и отключать нотификации по их типам, однако раздельные профили с разными
настройками не поддерживаются. В случае подключения одного пользователя с нескольких
WebSocket-соединений - все коннекты получат сообщения.

---

#### `onlineNotify.on`

**Запрос ===>**

|    Процедура    | Авторизация | Описание                                                                                                                                                                                                           |
| :-------------: | :---------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| onlineNotify.on |  Требуется  | Подписка на рассылку нотификаций о событиях для пользователя, сервер будет присылать их по вебсокету по факту их появления для этого пользователя, можно подписываться с разных устройств и браузеров одновременно |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Подписываемся на рассылку нотификаций с сервера

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "onlineNotify.on",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `onlineNotify.off`

**Запрос ===>**

|    Процедура     | Авторизация | Описание                                                                                                 |
| :--------------: | :---------: | -------------------------------------------------------------------------------------------------------- |
| onlineNotify.off |  Требуется  | Отписка от рассылки нотификаций о событиях для пользователя, сервер перестанет присылать их по вебсокету |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Отписываемся от рассылки нотификаций с сервера

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "onlineNotify.off",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `onlineNotify.history`

**Запрос ===>**

|      Процедура       | Авторизация | Описание                                                                |
| :------------------: | :---------: | ----------------------------------------------------------------------- |
| onlineNotify.history |  Требуется  | Получение истории нотификаций с учетом настроек пользователя о рассылке |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "onlineNotify.history",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `onlineNotify.historyFresh`

**Запрос ===>**

|         Процедура         | Авторизация | Описание                                                                      |
| :-----------------------: | :---------: | ----------------------------------------------------------------------------- |
| onlineNotify.historyFresh |  Требуется  | Получение количества непрочитанных нотификаций с учетом настроек пользователя |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Получаем количество непрочитанных нотификаций по их типам

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "onlineNotify.historyFresh",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

```


-onlineNotify.history:
    fromId <string|null>(null)     // ID с которого нужно начать показывать историю, опционально
            limit <number>(10)             // Необходимое количество строк истории
            markAsViewed <boolean>(true)   // Пометить ли все выгруженные записи как прочитанные
            freshOnly <boolean>(false)     // Возвратить только непрочитанные данные
```

### Push-нотификации с учетом настроек (Push для мобильных устройств)

Имеется возможность работать с нотификациями о каких-либо событиях, рассылаемых с сервера на клиент
через Push-уведомления с необходимым языком сообщений, достаточно лишь вызвать метод подписывающий
push-ключ на их рассылку. Имеется возможность включать и отключать нотификации по их типам с поддержкой
разных профилей, что позволяет уникально настраивать каждое устройство по необходимости.

---

#### `push.notifyOn`

**Запрос ===>**

|   Процедура   | Авторизация | Описание                                                                                                                                                                                                  |
| :-----------: | :---------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| push.notifyOn |  Требуется  | Подписка на рассылку push-нотификаций о событиях для пользователя, можно подписываться с разных мобильных устройств одновременно, настройки рассылки персональны для каждого профиля у каждого устройства |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "push.notifyOn",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `push.notifyOff`

**Запрос ===>**

|   Процедура    | Авторизация | Описание                                                                                                      |
| :------------: | :---------: | ------------------------------------------------------------------------------------------------------------- |
| push.notifyOff |  Требуется  | Отписка от рассылки push-нотификаций о событиях для пользователя для указанного профиля указанного устройства |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "push.notifyOff",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `push.history`

**Запрос ===>**

|  Процедура   | Авторизация | Описание                                                                                                                                    |
| :----------: | :---------: | ------------------------------------------------------------------------------------------------------------------------------------------- |
| push.history |  Требуется  | Получение истории нотификаций с учетом настроек пользователя о рассылке, также можно получить историю только по указанным типам нотификаций |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "push.history",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `push.historyFresh`

**Запрос ===>**

|     Процедура     | Авторизация | Описание                                                                                              |
| :---------------: | :---------: | ----------------------------------------------------------------------------------------------------- |
| push.historyFresh |  Требуется  | Получение количества непрочитанных нотификаций с учетом настроек пользователя для конкретного профиля |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "push.historyFresh",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

```
-push.notifyOn:

        key <string>        // Ключ рассылки нотификации
        profile <string>    // Идентификатор профиля пользователя

-push.notifyOff:

        key <string>        // Ключ рассылки нотификации
        profile <string>    // Идентификатор профиля пользователя

-push.history:

        profile <profile>                  // Профиль пользователя
        afterId <string|null>(null)        // ID после которого нужно начать показывать историю, опционально
        limit <number>(10)                 // Необходимое количество строк истории
        markAsViewed <boolean>(true)       // Пометить ли все выгруженные записи как прочитанные
        freshOnly <boolean>(false)         // Возвратить только непрочитанные данные
        types <string[]|'all'|null>(null)  // Массив необходимых типов нотификаций из которого будут вычтены те типы,
                                           // которые пользователь отключил в своих настройках.
                                           // Отсутствие параметра эквивалентно запросу 'all', который возвращает
                                           // все доступные типы согласно настройкам пользователя.
            [
             vote                          // лайк (голос)
            | flag                         // флаг (дизлайк, жалоба)
            | transfer                     // перевод средств
            | reply                        // ответ на пост или комментарий
            | subscribe                    // подписка на блог
            | unsubscribe                  // отписка от блога
            | mention                      // упоминание в посте, заголовке поста или в комменте (через @)
            | repost                       // репост
            | reward                       // награда пользователю
            | curatorReward                // награда куратору
            | message                      // личное сообщение (не реализованно в данной версии)
            | witnessVote                  // голос за делегата
            | witnessCancelVote            // отмена голоса за делегата
            ]

-push.historyFresh:

        profile <profile>              // Профиль пользователя
```

### Нотификации пользователя (данные в оригинальном виде и черные списки)

Система нотификаций занимается рассылкой нотификаций пользователям о различных событиях, которые
происходят в системе и которые касаются лично их. Текущая секция апи предоставляет доступ
к истории нотификаций, а также к работе с черными списками. История нотификаций отдается без
учета настроек пользователя т.к. они зависят от типа подписки на рассылку, данные с фильтрацией
по настройкам содержатся в соответствующих разделах.

---

#### `notify.getHistory`

**Запрос ===>**

|     Процедура     | Авторизация | Описание |
| :---------------: | :---------: | -------- |
| notify.getHistory |  Требуется  | TODO     |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.getHistory",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `notify.getHistoryFresh`

**Запрос ===>**

|       Процедура        | Авторизация | Описание                                       |
| :--------------------: | :---------: | ---------------------------------------------- |
| notify.getHistoryFresh |  Требуется  | Получение количества непрочитанных нотификаций |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Получаем количество непрочитанных нотификаций по их типам

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.getHistoryFresh",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `notify.markAsViewed`

**Запрос ===>**

|      Процедура      | Авторизация | Описание |
| :-----------------: | :---------: | -------- |
| notify.markAsViewed |  Требуется  | TODO     |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.markAsViewed",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `notify.markAllAsViewed`

**Запрос ===>**

|       Процедура        | Авторизация | Описание                                              |
| :--------------------: | :---------: | ----------------------------------------------------- |
| notify.markAllAsViewed |  Требуется  | Пометка всех нотификаций пользователя как прочитанные |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Помечаем все нотификации пользователя как прочитанные

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.markAllAsViewed",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `notify.getBlackList`

**Запрос ===>**

|      Процедура      | Авторизация | Описание                                                                                                       |
| :-----------------: | :---------: | -------------------------------------------------------------------------------------------------------------- |
| notify.getBlackList |  Требуется  | Получение черного списка пользователя, список содержит пользователей от которых рассылка нотификаций запрещена |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Получаем черный список пользователя

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.getBlackList",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `notify.addToBlackList`

**Запрос ===>**

|       Процедура       | Авторизация | Описание                                                                                                         |
| :-------------------: | :---------: | ---------------------------------------------------------------------------------------------------------------- |
| notify.addToBlackList |  Требуется  | Добавление пользователя в черный список, список содержит пользователей от которых рассылка нотификаций запрещена |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

Добавляем пользователя в черный список

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.addToBlackList",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `notify.removeFromBlackList`

**Запрос ===>**

|         Процедура          | Авторизация | Описание                                                                                                         |
| :------------------------: | :---------: | ---------------------------------------------------------------------------------------------------------------- |
| notify.removeFromBlackList |  Требуется  | Удаление пользователя из черного списка, список содержит пользователей от которых рассылка нотификаций запрещена |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

Удаляем пользователя из черного списка

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "notify.removeFromBlackList",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

```
-notify.getHistory:                     // Получение истории нотификаций

        fromId <string|null>(null)     // ID с которого нужно начать показывать историю, опционально
        limit <number>(10)             // Необходимое количество строк истории
        markAsViewed <boolean>(true)   // Пометить ли все выгруженные записи как прочитанные
        freshOnly <boolean>(false)     // Возвратить только непрочитанные данные
        types <'all'|string[]>('all')  // Массив необходимых типов нотификаций или 'all' если нужны все
            [
              vote               // лайк (голос)
            | flag               // флаг (дизлайк, жалоба)
            | transfer           // перевод средств
            | reply              // ответ на пост или комментарий
            | subscribe          // подписка на блог
            | unsubscribe        // отписка от блога
            | mention            // упоминание в посте, заголовке поста или в комменте (через @)
            | repost             // репост
            | reward             // награда пользователю
            | curatorReward      // награда куратору
            | message            // личное сообщение (не реализованно в данной версии)
            | witnessVote        // голос за делегата
            | witnessCancelVote  // отмена голоса за делегата
            ]

-notify.getHistoryFresh:


-notify.markAsViewed:         // Пометить указанные нотификации как прочитанные

        ids <string[]>       // Список идентификаторов для пометки

-notify.markAllAsViewed:      // Пометить все нотификации как прочитанные


-notify.getBlackList:


-notify.addToBlackList:
     banned <string>         // Имя пользователя для добавления

-notify.removeFromBlackList:
     banned <string>         // Имя пользователя для исключения
```

### Избранное

Апи предоставляет работу с избранным - контентом, который как-либо может быть помечен пользователем
как избранный для него контент.

---

#### `favorites.get`

**Запрос ===>**

|   Процедура   | Авторизация | Описание                              |
| :-----------: | :---------: | ------------------------------------- |
| favorites.get |  Требуется  | Получить избранные посты пользователя |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

Получаем список постов, которые пользователь добавил в избранное

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "favorites.get",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `favorites.add`

**Запрос ===>**

|   Процедура   | Авторизация | Описание                  |
| :-----------: | :---------: | ------------------------- |
| favorites.add |  Требуется  | Добавить пост в избранные |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Добавляем пост в избранное

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "favorites.add",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `favorites.remove`

**Запрос ===>**

|    Процедура     | Авторизация | Описание                  |
| :--------------: | :---------: | ------------------------- |
| favorites.remove |  Требуется  | Удалить пост из избранных |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

Удаляем пост из избранного

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "favorites.remove",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

```
-favorites.get:


-favorites.add:
        permlink <string>    // Пермлинк поста

-favorites.remove:
        permlink <string>    // Пермлинк поста
```

### Мета-данные

Апи позволяет работать с мета-данными пользователя - это такой класс данных,
который как-либо описывает пользователя, его состояние и представляет его данные,
но именно те, которые он, по бизнес-логике, не может менять явно, но может
менять своими действиями. Например - сохраняется тот факт что пользователь
сейчас онлайн. Данные которые пользователь, по бизнес-логике, должен менять
явным образом - обрабатываются другим апи.

---

#### `meta.markUserOnline`

**Запрос ===>**

|      Процедура      | Авторизация | Описание                  |
| :-----------------: | :---------: | ------------------------- |
| meta.markUserOnline |  Требуется  | Пометить юзера как онлайн |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Помечаем пользователя как онлайн

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "meta.markUserOnline",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `meta.recordPostView`

**Запрос ===>**

|      Процедура      | Авторизация  | Описание                                                                                                         |
| :-----------------: | :----------: | ---------------------------------------------------------------------------------------------------------------- |
| meta.recordPostView | Не требуется | Запись факта просмотра поста, просмотр может быть учтен или не учтен в зависимости от проверки системы валидации |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "meta.recordPostView",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `meta.getPostsViewCount`

**Запрос ===>**

|       Процедура        | Авторизация  | Описание                                            |
| :--------------------: | :----------: | --------------------------------------------------- |
| meta.getPostsViewCount | Не требуется | Получить количество просмотров указанных для постов |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "meta.getPostsViewCount",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `meta.getUserLastOnline`

**Запрос ===>**

|       Процедура        | Авторизация  | Описание                                                    |
| :--------------------: | :----------: | ----------------------------------------------------------- |
| meta.getUserLastOnline | Не требуется | Получить время (timestamp) последного онлайна пользователей |

| Параметр | Тип | Обяз. | Описание |
| :------: | :---: | :---: | -------- |


Пример:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "meta.getUserLastOnline",
  "params": {
    // TODO Будет описан позднее
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

```
-meta.markUserOnline:

-meta.recordPostView
    postLink <string>            // Полная ссылка на пост author/perm-link
    fingerPrint <string>         // Finger print браузера

-meta.getPostsViewCount
    postLinks <string[]>         // Список ссылок на посты в формате author/perm-link

-meta.getUserLastOnline:
    user <string>                // Имя пользователя

```

### Курсы валют

Апи предоставляет возможность получить актуальные курсы валют относительно валют CyberWay.

---

#### `rates.getActual`

**Запрос ===>**

|    Процедура    | Авторизация  | Описание                         |
| :-------------: | :----------: | -------------------------------- |
| rates.getActual | Не требуется | Получить актуальные курсы обмена |

| Параметры отсутствуют |
| :-------------------: |


Пример:

Получить текущие курсы валют

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "rates.getActual",
  "params": {}
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `rates.getHistorical`

**Запрос ===>**

|      Процедура      | Авторизация  | Описание                       |
| :-----------------: | :----------: | ------------------------------ |
| rates.getHistorical | Не требуется | Получить историю курсов обмена |

| Параметр |     Тип      | Обяз. | Описание         |
| :------: | :----------: | :---: | ---------------- |
|   date   | string(Date) |  Да   | Необходимая дата |

Пример:

Получить историю за необходимую дату

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "rates.getHistorical",
  "params": {
    "date": "2019-03-19T14:09:14.584Z"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `rates.getHistoricalMulti`

**Запрос ===>**

|        Процедура         | Авторизация  | Описание                                          |
| :----------------------: | :----------: | ------------------------------------------------- |
| rates.getHistoricalMulti | Не требуется | Получить историю курсов обмена для нескольких дат |

| Параметр |      Тип       | Обяз. | Описание               |
| :------: | :------------: | :---: | ---------------------- |
|  dates   | string(Date)[] |  Да   | Массив необходимых дат |

Пример:

Получить историю за несколько необходимых дат

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "rates.getHistoricalMulti",
  "params": {
    "dates": [
      "2019-03-10T14:09:14.584Z",
      "2019-03-12T14:09:14.584Z",
      "2019-03-18T14:09:14.584Z"
    ]
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

--

### Контент и ленты

// Описание

---

#### `content.getProfile`

**Запрос ===>**

|     Процедура      | Авторизация  | Описание                       |
| :----------------: | :----------: | ------------------------------ |
| content.getProfile | Не требуется | Получение профиля пользователя |

| Параметр |  Тип   | Обяз. | Описание                   |
| :------: | :----: | :---: | -------------------------- |
|  userId  | string |  Да   | Идентификатор пользователя |

Пример:

Получить профиль пользователя `destroyer2k`

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "content.getProfile",
  "params": {
    "userId": "destroyer2k"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `content.getPost`

**Запрос ===>**

|    Процедура    | Авторизация  | Описание        |
| :-------------: | :----------: | --------------- |
| content.getPost | Не требуется | Получение поста |

|  Параметр   |  Тип   | Обяз. | Описание                   |
| :---------: | :----: | :---: | -------------------------- |
|   userId    | string |  Да   | Идентификатор пользователя |
|  permlink   | string |  Да   | Пермлинк поста             |
| refBlockNum | number |  Да   | Привязанный блок поста     |

Пример:

Получить пост, идентифицируемый указанными параметрами

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "content.getPost",
  "params": {
    "userId": "destroyer2k",
    "permlink": "myowncontent",
    "refBlockNum": 12345
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `content.getFeed`

**Запрос ===>**

|    Процедура    | Авторизация  | Описание               |
| :-------------: | :----------: | ---------------------- |
| content.getFeed | Не требуется | Получение ленты постов |

|  Параметр   |  Тип   |               Обяз.                | По умолч. |         Варианты         | Описание                                                                                   |
| :---------: | :----: | :--------------------------------: | :-------: | :----------------------: | ------------------------------------------------------------------------------------------ |
|    type     | string |                Нет                 | community |                          | Тип ленты                                                                                  |
|             |        |                                    |           |        community         | Лента комьюнити                                                                            |
|             |        |                                    |           |      subscriptions       | Лента подписок пользователя                                                                |
|             |        |                                    |           |          byUser          | Лента постов самого пользователя                                                           |
|   sortBy    | string |                Нет                 |   time    |                          | Способ сортировки                                                                          |
|             |        |                                    |           |           time           | Сначала старые, потом новые                                                                |
|             |        |                                    |           |         timeDesc         | Сначала новые, потом старые                                                                |
|             |        |                                    |           | popular (type=community) | По популярности                                                                            |
|  timeframe  | string |  type=community и sortBy=popular   |    day    |                          | Область выборки сортировки                                                                 |
|             |        |                                    |           |           day            | За день                                                                                    |
|             |        |                                    |           |           week           | За неделю                                                                                  |
|             |        |                                    |           |          month           | За месяц                                                                                   |
|             |        |                                    |           |           year           | За год                                                                                     |
|             |        |                                    |           |           all            | За всё время                                                                               |
|             |        |                                    |           |        WilsonHot         | Aлгоритм Вилсона - актуальный контент сейчас                                               |
|             |        |                                    |           |      WilsonTrending      | Aлгоритм Вилсона - в целом популярный контент                                              |
| sequenceKey | string |                Нет                 |   null    |                          | Ключ пагинации с сервера для получения следующего списка данных, null вернет первый список |
|    limit    | number |                Нет                 |    10     |                          | Количество необходимых постов                                                              |
|   userId    | string | type=subscriptions или type=byUser |   _нет_   |                          | Идентификатор пользователя                                                                 |
| communityId | string |           type=community           |   _нет_   |                          | Идентификатор комьюнити                                                                    |

Пример:

Получить ленту популярного контента для комьюнити `gls`

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "content.getFeed",
  "params": {
    "sortBy": "popular",
    "communityId": "gls"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

#### `content.getComments`

**Запрос ===>**

|      Процедура      | Авторизация  | Описание                     |
| :-----------------: | :----------: | ---------------------------- |
| content.getComments | Не требуется | Получение ленты комментариев |

|  Параметр   |  Тип   |          Обяз.          | По умолч. | Варианты | Описание                                                                                   |
| :---------: | :----: | :---------------------: | :-------: | :------: | ------------------------------------------------------------------------------------------ |
|   sortBy    | string |           Нет           |   time    |          | Способ сортировки                                                                          |
|             |        |                         |           |   time   | Сначала старые, потом новые                                                                |
|             |        |                         |           | timeDesc | Сначала новые, потом старые                                                                |
| sequenceKey | string |           Нет           |   null    |          | Ключ пагинации с сервера для получения следующего списка данных, null вернет первый список |
|    limit    | number |           Нет           |    10     |          | Количество необходимых комментариев                                                        |
|    type     | string |           Нет           |   post    |          | Тип ленты комментариев                                                                     |
|             |        |                         |           |   post   | Получить комментарии для поста                                                             |
|             |        |                         |           |   user   | Получить комментарии пользователя                                                          |
|   userId    | string | type=user или type=post |   _нет_   |          | Идентификатор пользователя                                                                 |
|  permlink   | string |        type=post        |   _нет_   |          | Пермлинк поста                                                                             |
| refBlockNum | number |        type=post        |   _нет_   |          | Привязанный блок поста                                                                     |

Пример:

Получить список комментариев для поста, идентифицируемого указанными параметрами

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "content.getComments",
  "params": {
    "userId": "destroyer2k",
    "permlink": "myowncontent",
    "refBlockNum": 12345
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

### Встроенный контент

// Описание

---

#### `frame.getEmbed`

**Запрос ===>**

|   Процедура    | Авторизация  | Описание                                              |
| :------------: | :----------: | ----------------------------------------------------- |
| frame.getEmbed | Не требуется | Получить обработанные данные для встраивания контента |

| Параметр |  Тип   | Обяз. | По умолч. | Варианты | Описание                       |
| :------: | :----: | :---: | :-------: | :------: | ------------------------------ |
|   type   | string |  Да   |   _нет_   |          | Тип обработки                  |
|          |        |       |           |  oembed  | Обработать сервисом "oembed"   |
|          |        |       |           | iframely | Обработать сервисом "iframely" |
|   url    | string |  Да   |   _нет_   |          | Ссылка на контент              |

Пример:

Обработать и получить контент по ссылке `https://site.com/content` используя `oembed`

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "frame.getEmbed",
  "params": {
    "type": "oembed",
    "url": "https://site.com/content"
  }
}
```

**<=== Ответ**

_Не описан..._

**<=x= Ошибки**

_Не описаны..._

---

### Авторизация

```
Не требует авторизацию.

 'auth.generateSecret':   // Получить секрет авторизации для подписи
     <empty>  // Без параметров

 <- result:               // Варианты ответа
     (success):           // В случае успеха
         secret <string>  // Секрет авторизации

 <- error:                // Варианты ошибок
     <shared>             // Нет уникальных ошибок

 'auth.authorize':                    // Авторизоваться
     user <string>        // Имя пользователя
     sign <sign>          // Подпись пользователя

 <- result:              // Варианты ответа
     (success):          // В случае успеха
         status <'OK'>   // Прошло успешно

 <- error:
     1102   // Доступ запрещен, не валидный формат данных авторизации
     1103   // Доступ запрещен, блокчейн отверг авторизацию

 <shared>:

 <- error:  // Варианты ошибок
     1101   // Доступ запрещен, запрашиваемый метод не входит в разрешенный список
     1104   // Ошибка передачи данных микросервису фасаду, вероятно проблема со связью
```
